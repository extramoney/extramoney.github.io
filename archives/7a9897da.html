<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">
<meta name="google-site-verification" content="2ENHO5ddmQrEQyGOO-96OnxndmeNNMHKfz_Ki7JH5PE" />









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-128x128-cloud.ico?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-cloud.ico?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-cloud.ico?v=5.1.3">


  <link rel="mask-icon" href="/images/filter-drama.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Android,view,Webview," />





  <link rel="alternate" href="/atom.xml" title="小面包屑的博客" type="application/atom+xml" />






<meta name="description" content="基本使用加载html四种方式12345678910webView.loadUrl(&quot;http://139.196.35.30:8080/OkHttpTest/apppackage/test.html&quot;);//加载urlwebView.loadUrl(&quot;file:///android_asset/test.html&quot;);//加载asset文件夹下html//方式3：加载手机sdcard上的html页">
<meta name="keywords" content="Android,view,Webview">
<meta property="og:type" content="article">
<meta property="og:title" content="关于 android Webview">
<meta property="og:url" content="http://lethisis.com/archives/7a9897da.html">
<meta property="og:site_name" content="小面包屑的博客">
<meta property="og:description" content="基本使用加载html四种方式12345678910webView.loadUrl(&quot;http://139.196.35.30:8080/OkHttpTest/apppackage/test.html&quot;);//加载urlwebView.loadUrl(&quot;file:///android_asset/test.html&quot;);//加载asset文件夹下html//方式3：加载手机sdcard上的html页">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1760285-50e94caafaa9fa26.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1760285-32d3e813305b8b4e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1760285-876ad266e613ccd1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1760285-f2cf1fbe3ffc2a7b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1760285-3c824ed614fb5a54.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2017-11-17T08:58:51.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="关于 android Webview">
<meta name="twitter:description" content="基本使用加载html四种方式12345678910webView.loadUrl(&quot;http://139.196.35.30:8080/OkHttpTest/apppackage/test.html&quot;);//加载urlwebView.loadUrl(&quot;file:///android_asset/test.html&quot;);//加载asset文件夹下html//方式3：加载手机sdcard上的html页">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/1760285-50e94caafaa9fa26.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://lethisis.com/archives/7a9897da.html"/>





  <title>关于 android Webview | 小面包屑的博客</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?5de538caff6efe3edec863f94acd055a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">小面包屑的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Code & Life</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lethisis.com/archives/7a9897da.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小面包屑">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar_luwan.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小面包屑的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">关于 android Webview</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-17T16:50:34+08:00">
                2017-11-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/archives/7a9897da.html" class="leancloud_visitors" data-flag-title="关于 android Webview">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><h3 id="加载html四种方式"><a href="#加载html四种方式" class="headerlink" title="加载html四种方式"></a>加载html四种方式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">webView.loadUrl(<span class="string">"http://139.196.35.30:8080/OkHttpTest/apppackage/test.html"</span>);<span class="comment">//加载url</span></div><div class="line"></div><div class="line">webView.loadUrl(<span class="string">"file:///android_asset/test.html"</span>);<span class="comment">//加载asset文件夹下html</span></div><div class="line"></div><div class="line"><span class="comment">//方式3：加载手机sdcard上的html页面</span></div><div class="line">webView.loadUrl(<span class="string">"content://com.ansen.webview/sdcard/test.html"</span>);</div><div class="line"></div><div class="line"><span class="comment">//方式4 使用webview显示html代码</span></div><div class="line">webView.loadDataWithBaseURL(<span class="keyword">null</span>,<span class="string">"&lt;html&gt;&lt;head&gt;&lt;title&gt; 欢迎您 &lt;/title&gt;&lt;/head&gt;"</span> +</div><div class="line">        <span class="string">"&lt;body&gt;&lt;h2&gt;使用webview显示 html代码&lt;/h2&gt;&lt;/body&gt;&lt;/html&gt;"</span>, <span class="string">"text/html"</span> , <span class="string">"utf-8"</span>, <span class="keyword">null</span>);</div></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h3><h4 id="在AndroidManifest-xml中添加网络权限"><a href="#在AndroidManifest-xml中添加网络权限" class="headerlink" title="在AndroidManifest.xml中添加网络权限"></a>在AndroidManifest.xml中添加网络权限</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:name=<span class="string">"android.permission.INTERNET"</span> /&gt;</div></pre></td></tr></table></figure>
<h4 id="布局文件-activity-main-xml"><a href="#布局文件-activity-main-xml" class="headerlink" title="布局文件 activity_main.xml"></a>布局文件 activity_main.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"fill_parent"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">FrameLayout</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/xwalk_view"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"@color/white"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:focusable</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:focusableInTouchMode</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ProgressBar</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/web_progress"</span></span></div><div class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">"?android:attr/progressBarStyleHorizontal"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:indeterminate</span>=<span class="string">"false"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:indeterminateOnly</span>=<span class="string">"false"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:maxHeight</span>=<span class="string">"2dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:minHeight</span>=<span class="string">"2dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:progressDrawable</span>=<span class="string">"@drawable/progress_bar_horizontal"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>使用webview 动态加载，防止放生内存泄漏</p>
<h4 id="MainActivity-java-webview-动态加载"><a href="#MainActivity-java-webview-动态加载" class="headerlink" title="MainActivity.java webview 动态加载"></a>MainActivity.java webview 动态加载</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//初始化</span></div><div class="line">WebView      mWebView = <span class="keyword">new</span> WebView(getApplicationgContext());  </div><div class="line">FrameLayout frameLayout      = findViewById(R.id.xwalk_view);  </div><div class="line">frameLayout.addView(mWebView);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;  </div><div class="line">      <span class="keyword">super</span>.onDestroy();  </div><div class="line">      mWebView.removeAllViews();  </div><div class="line">       ((ViewGroup) mWebView.getParent()).removeView(mWebView);</div><div class="line">        mWebView.setTag(<span class="keyword">null</span>);</div><div class="line">        mWebView.clearHistory();</div><div class="line">        mWebView.destroy();</div><div class="line">        mWebView= <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="WebViewClient与WebChromeClient区别"><a href="#WebViewClient与WebChromeClient区别" class="headerlink" title="WebViewClient与WebChromeClient区别"></a>WebViewClient与WebChromeClient区别</h4><blockquote>
<p>WebViewClient主要帮助WebView处理各种通知、请求事件的，有以下常用方法： </p>
<ul>
<li>onPageFinished 页面请求完成 </li>
<li>onPageStarted 页面开始加载 </li>
<li>shouldOverrideUrlLoading 拦截url </li>
<li>onReceivedError 访问错误时回调，例如访问网页时报错404，在这个方法回调的时候可以加载错误页面。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//WebViewClient主要帮助WebView处理各种通知、请求事件</span></div><div class="line">  <span class="keyword">private</span> WebViewClient webViewClient=<span class="keyword">new</span> WebViewClient()&#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageFinished</span><span class="params">(WebView view, String url)</span> </span>&#123;<span class="comment">//页面加载完成</span></div><div class="line">          progressBar.setVisibility(View.GONE);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageStarted</span><span class="params">(WebView view, String url, Bitmap favicon)</span> </span>&#123;<span class="comment">//页面开始加载</span></div><div class="line">          progressBar.setVisibility(View.VISIBLE);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line">          Log.i(<span class="string">"ansen"</span>,<span class="string">"拦截url:"</span>+url);</div><div class="line">          <span class="keyword">if</span>(url.equals(<span class="string">"http://www.google.com/"</span>))&#123;</div><div class="line">              Toast.makeText(MainActivity.<span class="keyword">this</span>,<span class="string">"国内不能访问google,拦截该url"</span>,Toast.LENGTH_LONG).show();</div><div class="line">              <span class="keyword">return</span> <span class="keyword">true</span>;<span class="comment">//表示我已经处理过了</span></div><div class="line">          &#125;</div><div class="line">          <span class="keyword">return</span> <span class="keyword">super</span>.shouldOverrideUrlLoading(view, url);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">  &#125;;</div></pre></td></tr></table></figure>
<blockquote>
<p>WebChromeClient主要辅助WebView处理Javascript的对话框、网站图标、网站title、加载进度等，有以下常用方法。 </p>
</blockquote>
<ul>
<li>onJsAlert webview不支持js的alert弹窗，需要自己监听然后通过dialog弹窗 </li>
<li>onReceivedTitle 获取网页标题 </li>
<li>onReceivedIcon 获取网页icon </li>
<li>onProgressChanged 加载进度回调</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//WebChromeClient主要辅助WebView处理Javascript的对话框、网站图标、网站title、加载进度等</span></div><div class="line">    <span class="keyword">private</span> WebChromeClient webChromeClient=<span class="keyword">new</span> WebChromeClient()&#123;</div><div class="line">        <span class="comment">//不支持js的alert弹窗，需要自己监听然后通过dialog弹窗</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onJsAlert</span><span class="params">(WebView webView, String url, String message, JsResult result)</span> </span>&#123;</div><div class="line">            AlertDialog.Builder localBuilder = <span class="keyword">new</span> AlertDialog.Builder(webView.getContext());</div><div class="line">            localBuilder.setMessage(message).setPositiveButton(<span class="string">"确定"</span>,<span class="keyword">null</span>);</div><div class="line">            localBuilder.setCancelable(<span class="keyword">false</span>);</div><div class="line">            localBuilder.create().show();</div><div class="line"></div><div class="line">            <span class="comment">//注意:</span></div><div class="line">            <span class="comment">//必须要这一句代码:result.confirm()表示:</span></div><div class="line">            <span class="comment">//处理结果为确定状态同时唤醒WebCore线程</span></div><div class="line">            <span class="comment">//否则不能继续点击按钮</span></div><div class="line">            result.confirm();</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//获取网页标题</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedTitle</span><span class="params">(WebView view, String title)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>.onReceivedTitle(view, title);</div><div class="line">            Log.i(<span class="string">"ansen"</span>,<span class="string">"网页标题:"</span>+title);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//加载进度回调</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProgressChanged</span><span class="params">(WebView view, <span class="keyword">int</span> newProgress)</span> </span>&#123;</div><div class="line">            progressBar.setProgress(newProgress);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div></pre></td></tr></table></figure>
<blockquote>
<p>网页中有H5播放flash video的时候按下全屏按钮将会调用到这个方法，一般用作设置网页播放全屏操作</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onShowCustomView</span><span class="params">(View view, CustomViewCallback callback)</span></span></div></pre></td></tr></table></figure>
<p>取消全屏方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void onHideCustomView()</div></pre></td></tr></table></figure></p>
<h5 id="WebChromeClient高级功能实现"><a href="#WebChromeClient高级功能实现" class="headerlink" title="WebChromeClient高级功能实现"></a>WebChromeClient高级功能实现</h5><p>GoogleChrome高级使用实例<br><a href="https://github.com/googlearchive/chromium-webview-samples" target="_blank" rel="external">GitHub - googlearchive/chromium-webview-samples: Useful examples for Developing apps with the Chromium based WebView</a></p>
<h6 id="让你的webview支持File-Input-标签"><a href="#让你的webview支持File-Input-标签" class="headerlink" title="让你的webview支持File Input 标签"></a>让你的webview支持File Input 标签</h6><blockquote>
<p>在Android 5.0 API 21后 借助新的 onShowFileChooser() 方法,您现在不但可以在 WebView 中使用输入表单字段,而且可以启动文件选择器从 Android 设备中选择图片和文件</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onShowFileChooser</span><span class="params">(WebView webView, ValueCallback&lt;Uri[]&gt; filePathCallback,</span></span></div><div class="line"><span class="function"><span class="params">                                 WebChromeClient.FileChooserParams fileChooserParams)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (mFilePathCallback != <span class="keyword">null</span>) &#123;</div><div class="line">        mFilePathCallback.onReceiveValue(<span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line">    mFilePathCallback = filePathCallback;</div><div class="line"></div><div class="line">    Intent takePictureIntent = <span class="keyword">new</span> Intent(MediaStore.ACTION_IMAGE_CAPTURE);</div><div class="line">    <span class="keyword">if</span> (takePictureIntent.resolveActivity(getPackageManager()) != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="comment">// Create the File where the photo should go</span></div><div class="line">        File photoFile = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            photoFile = createImageFile();</div><div class="line">            takePictureIntent.putExtra(<span class="string">"PhotoPath"</span>, mCameraPhotoPath);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</div><div class="line">            <span class="comment">// Error occurred while creating the File</span></div><div class="line">            Log.e(TAG, <span class="string">"Unable to create Image File"</span>, ex);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// Continue only if the File was successfully created</span></div><div class="line">        <span class="keyword">if</span> (photoFile != <span class="keyword">null</span>) &#123;</div><div class="line">            mCameraPhotoPath = <span class="string">"file:"</span> + photoFile.getAbsolutePath();</div><div class="line">            takePictureIntent.putExtra(MediaStore.EXTRA_OUTPUT,</div><div class="line">                    Uri.fromFile(photoFile));</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            takePictureIntent = <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Intent contentSelectionIntent = <span class="keyword">new</span> Intent(Intent.ACTION_GET_CONTENT);</div><div class="line">    contentSelectionIntent.addCategory(Intent.CATEGORY_OPENABLE);</div><div class="line">    contentSelectionIntent.setType(<span class="string">"image/*"</span>);</div><div class="line"></div><div class="line">    Intent[] intentArray;</div><div class="line">    <span class="keyword">if</span> (takePictureIntent != <span class="keyword">null</span>) &#123;</div><div class="line">        intentArray = <span class="keyword">new</span> Intent[]&#123;takePictureIntent&#125;;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        intentArray = <span class="keyword">new</span> Intent[<span class="number">0</span>];</div><div class="line">    &#125;</div><div class="line">    Intent chooserIntent = <span class="keyword">new</span> Intent(Intent.ACTION_CHOOSER);</div><div class="line">    chooserIntent.putExtra(Intent.EXTRA_INTENT, contentSelectionIntent);</div><div class="line">    chooserIntent.putExtra(Intent.EXTRA_TITLE, <span class="string">"Image Chooser"</span>);</div><div class="line">    chooserIntent.putExtra(Intent.EXTRA_INITIAL_INTENTS, intentArray);</div><div class="line">    startActivityForResult(chooserIntent, INPUT_FILE_REQUEST_CODE);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>在选择完图片后回调onActivityResult 获取图片<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (requestCode != INPUT_FILE_REQUEST_CODE || mFilePathCallback == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, data);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Uri[] results = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Check that the response is a good one</span></div><div class="line">    <span class="keyword">if</span> (resultCode == Activity.RESULT_OK) &#123;</div><div class="line">        <span class="keyword">if</span> (data == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">// If there is not data, then we may have taken a photo</span></div><div class="line">            <span class="keyword">if</span> (mCameraPhotoPath != <span class="keyword">null</span>) &#123;</div><div class="line">                results = <span class="keyword">new</span> Uri[]&#123;Uri.parse(mCameraPhotoPath)&#125;;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            String dataString = data.getDataString();</div><div class="line">            <span class="keyword">if</span> (dataString != <span class="keyword">null</span>) &#123;</div><div class="line">                results = <span class="keyword">new</span> Uri[]&#123;Uri.parse(dataString)&#125;;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    mFilePathCallback.onReceiveValue(results);</div><div class="line">    mFilePathCallback = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h6 id="设置webview视频未播放时默认显示占位"><a href="#设置webview视频未播放时默认显示占位" class="headerlink" title="设置webview视频未播放时默认显示占位"></a>设置webview视频未播放时默认显示占位</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> Bitmap <span class="title">getDefaultVideoPoster</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(getActivity() == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> BitmapFactory.decodeResource(getActivity().getApplicationContext().getResources(),</div><div class="line">            R.drawable.video_poster);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="WebView下载监听"><a href="#WebView下载监听" class="headerlink" title="WebView下载监听"></a>WebView下载监听</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mWebView.setDownloadListener(<span class="keyword">new</span> DownloadListener() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDownloadStart</span><span class="params">(String url, String userAgent, String contentDisposition, String mimetype, <span class="keyword">long</span> contentLength)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="webView-设置"><a href="#webView-设置" class="headerlink" title="webView 设置"></a>webView 设置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">        webView.addJavascriptInterface(<span class="keyword">this</span>,<span class="string">"android"</span>);<span class="comment">//添加js监听 这样html就能调用客户端</span></div><div class="line">webView.setWebChromeClient(webChromeClient);</div><div class="line">webView.setWebViewClient(webViewClient);</div><div class="line"></div><div class="line"> WebSettings webSettings=webView.getSettings();</div><div class="line">       </div><div class="line"><span class="comment">// webview启用javascript支持 用于访问页面中的javascript</span></div><div class="line">webSettings.setJavaScriptEnabled(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">//设置WebView缓存模式 默认断网情况下不缓存</span></div><div class="line">webSettings.setCacheMode(WebSettings.LOAD_DEFAULT);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">         * LOAD_CACHE_ONLY: 不使用网络，只读取本地缓存数据</span></div><div class="line"><span class="comment">         * LOAD_DEFAULT: （默认）根据cache-control决定是否从网络上取数据。</span></div><div class="line"><span class="comment">         * LOAD_NO_CACHE: 不使用缓存，只从网络获取数据.</span></div><div class="line"><span class="comment">         * LOAD_CACHE_ELSE_NETWORK，只要本地有，无论是否过期，或者no-cache，都使用缓存中的数据。</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="comment">//断网情况下加载本地缓存</span></div><div class="line">webSettings.setCacheMode(WebSettings.LOAD_CACHE_ELSE_NETWORK);&#125;</div><div class="line"></div><div class="line"><span class="comment">//让WebView支持DOM storage API</span></div><div class="line">webSettings.setDomStorageEnabled(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">//让WebView支持缩放</span></div><div class="line">webSettings.setSupportZoom(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">//启用WebView内置缩放功能</span></div><div class="line">webSettings.setBuiltInZoomControls(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">//让WebView支持可任意比例缩放</span></div><div class="line">webSettings.setUseWideViewPort(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">//让WebView支持播放插件</span></div><div class="line">webSettings.setPluginState(WebSettings.PluginState.ON);</div><div class="line"></div><div class="line"><span class="comment">//设置WebView使用内置缩放机制时，是否展现在屏幕缩放控件上</span></div><div class="line">webSettings.setDisplayZoomControls(<span class="keyword">false</span>);</div><div class="line"></div><div class="line"><span class="comment">//设置在WebView内部是否允许访问文件</span></div><div class="line">webSettings.setAllowFileAccess(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">//设置WebView的访问UserAgent</span></div><div class="line">webSettings.setUserAgentString(WebViewUtil.getUserAgent(getActivity(), webSettings));</div><div class="line"></div><div class="line"><span class="comment">//设置脚本是否允许自动打开弹窗</span></div><div class="line">webSettings.setJavaScriptCanOpenWindowsAutomatically(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">// 加快HTML网页加载完成速度 </span></div><div class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">19</span>) &#123;   </div><div class="line">    settings.setLoadsImagesAutomatically(<span class="keyword">true</span>);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    settings.setLoadsImagesAutomatically(<span class="keyword">false</span>); </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 开启Application H5 Caches 功能 </span></div><div class="line">settings.setAppCacheEnabled(<span class="keyword">true</span>); </div><div class="line"></div><div class="line"><span class="comment">// 设置编码格式</span></div><div class="line">settings.setDefaultTextEncodingName(<span class="string">"utf-8"</span>);</div></pre></td></tr></table></figure>
<h4 id="返回webView的上一页面"><a href="#返回webView的上一页面" class="headerlink" title="返回webView的上一页面"></a>返回webView的上一页面</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onKeyDown</span><span class="params">(<span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;</div><div class="line">       Log.i(<span class="string">"ansen"</span>,<span class="string">"是否有上一个页面:"</span>+webView.canGoBack());</div><div class="line">       <span class="keyword">if</span> (webView.canGoBack() &amp;&amp; keyCode == KeyEvent.KEYCODE_BACK)&#123;<span class="comment">//点击返回按钮的时候判断有没有上一页</span></div><div class="line">           webView.goBack(); <span class="comment">// goBack()表示返回webView的上一页面</span></div><div class="line">           <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">super</span>.onKeyDown(keyCode,event);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h2 id="内核版本"><a href="#内核版本" class="headerlink" title="内核版本"></a>内核版本</h2><p>Android 中的Webview 在 4.4之前是webkit内核， 在4.4 和 4.4之后的版本是chromium 内核。</p>
<h3 id="Webkit内核"><a href="#Webkit内核" class="headerlink" title="Webkit内核"></a>Webkit内核</h3><blockquote>
<p>WebKit 是一个开源的浏览器引擎，与之相对应的引擎有Gecko（Mozilla Firefox 等使用）和Trident（也称MSHTML，IE 使用）。<br>同时WebKit 也是苹果Mac OS X 系统引擎框架版本的名称，主要用于Safari，Dashboard，Mail 和其他一些Mac OS X 程序。WebKit 前身是 KDE 小组的 KHTML，WebKit 所包含的 WebCore 排版引擎和 JSCore 引擎来自于 KDE 的 KHTML 和 KJS，当年苹果比较了 Gecko 和 KHTML 后，仍然选择了后者，就因为它拥有清晰的源码结构、极快的渲染速度。Apple将 KHTML 发扬光大，推出了装备 KHTML 改进型 WebKit 引擎的浏览器 Safari。<br>WebKit 所包含的 WebCore排版引擎和 JSCore 引擎，均是从KDE的KHTML及KJS引擎衍生而来。它们都是自由软件，在GPL条约下授权，同时支持BSD系统的开发。所以Webkit也是自由软件，同时开放源代码。<br>WebKit的优势在于高效稳定，兼容性好，且源码结构清晰，易于维护。</p>
</blockquote>
<h3 id="Chrominum内核"><a href="#Chrominum内核" class="headerlink" title="Chrominum内核"></a>Chrominum内核</h3><blockquote>
<p>Chromium 是 Google 的chrome浏览器背后的引擎，其目的是为了创建一个安全、稳定和快速的通用浏览器。<br>Chromium是一个由Google主导开发的网页浏览器。以BSD许可证等多重自由版权发行并开放源代码。Chromium的开发可能早自2006年即开始，设计思想基于简单、高速、稳定、安全等理念，在架构上使用了Apple发展出来的WebKit排版引擎、Safari的部份源代码与Firefox的成果，并采用Google独家开发出的V8引擎以提升解译JavaScript的效率，而且设计了“沙盒”、“黑名单”、“无痕浏览”等功能来实现稳定与安全的网页浏览环境。Chromium是Google为发展自家的浏览器Google Chrome（以下简称Chrome）而开启的计划，所以Chromium相当于Chrome的工程版或称实验版（尽管Chrome自身也有β版阶段），新功能会率先在Chromium上实现，待验证后才会应用在Chrome上，故Chrome的功能会相对落后但较稳定。Chromium的更新速度很快,每隔数小时即有新的开发版本发布，而且可以免安装，下载zip封装版后解压缩即可使用（Windows下也有安装版）。Chrome虽然理论上也可以免安装，但Google仅提供安装版。<br>Chromium和Chrome所使用的webkit内核是目前公认的最快的网页浏览方式。<br>使用Chromium开源代码（基于webkit内核）的浏览器有360极速浏览器、枫树浏览器、太阳花浏览器、世界之窗极速版、傲游浏览器和UC浏览器电脑版等。搜狗高速浏览器和qq浏览器官网未提及Chromium，只是说采用webkit内核，经网友测试这两款浏览器极有可能也是使用的Chromium，只是官方不承认而已。</p>
</blockquote>
<h3 id="Blink内核"><a href="#Blink内核" class="headerlink" title="Blink内核"></a>Blink内核</h3><blockquote>
<p>Blink 是由 WebKit 内核衍生出来的，是由 Chromium 开发维护的新项目。在官方的博客上有详细的说明：Blink: A rendering engine for the Chromium project。关于这个浏览器的更加详细的特性和目标，可以看这里：<a href="http://www.chromium.org/blink。大体就是一大堆的优化，提高速度，各种支持。" target="_blank" rel="external">http://www.chromium.org/blink。大体就是一大堆的优化，提高速度，各种支持。</a><br>之前的 WebKit 内核是由 谷歌 chrome 和 苹果 safari 共同开发，谷歌不干了，从 WebKit 中衍生分离出 Blink 不知道是何居心，不过浏览器渲染内核的多样性是肯定有了，以谷歌的技术，这种多样性应该会促进 Web 的发展。<br>对于国内来说，Blink 是开源引擎，X60 、X狗 之类的浏览器，又可以再增加一个核了，因为 Blink 对速度做了优化，应该会比 WebKit 还要快，所以可能会被命名为超急速三核切换功能。总之，妈妈再也不用担心我的浏览器核心不够用了。</p>
</blockquote>
<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><h3 id="常用缓存机制"><a href="#常用缓存机制" class="headerlink" title="常用缓存机制"></a>常用缓存机制</h3><p><img src="http://upload-images.jianshu.io/upload_images/1760285-50e94caafaa9fa26.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="六种 H5 常用的缓存机制的优势及适用场景"></p>
<ul>
<li><p>Dom Storage（Web Storage）存储机制：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">webSettings.setDomStorageEnabled(<span class="keyword">true</span>);</div></pre></td></tr></table></figure>
</li>
<li><p>Web SQL Database 存储机制（不推荐）</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">webSettings.setDatabaseEnabled(<span class="keyword">true</span>);</div><div class="line"><span class="keyword">final</span> String dbPath = getApplicationContext().getDir(<span class="string">"db"</span>,Context.MODE_PRIVATE).getPath();</div><div class="line">webSettings.setDatabasePath(dbPath)</div></pre></td></tr></table></figure>
<ul>
<li>Application Cache 存储机制（不推荐）<blockquote>
<p>Application Cache（简称 AppCache)似乎是为支持 Web App 离线使用而开发的缓存机制。它的缓存机制类似于浏览器的缓存（Cache-Control 和 Last-Modified）机制，都是以文件为单位进行缓存，且文件有一定更新机制。但 AppCache 是对浏览器缓存机制的补充，不是替代.<br>不过根据官方文档，AppCache 已经不推荐使用了，标准也不会再支持。现在主流的浏览器都是还支持 AppCache的，以后就不太确定了。同样给出 Android 端启用 AppCache 的代码。</p>
</blockquote>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">WebSettings webSettings = myWebView.getSettings();</div><div class="line">webSettings.setAppCacheEnabled(<span class="keyword">true</span>);</div><div class="line"><span class="keyword">final</span> String cachePath = getApplicationContext().getDir(<span class="string">"cache"</span>,Context.MODE_PRIVATE).getPath();</div><div class="line">webSettings.setAppCachePath(cachePath);</div><div class="line">webSettings.setAppCacheMaxSize(<span class="number">5</span>*<span class="number">1024</span>*<span class="number">1024</span>);</div></pre></td></tr></table></figure>
<ul>
<li>Indexed Database 存储机制</li>
</ul>
<blockquote>
<p>IndexedDB 也是一种数据库的存储机制，但不同于已经不再支持的 Web SQL Database。IndexedDB 不是传统的关系数据库，可归为 NoSQL 数据库。IndexedDB 又类似于 Dom Storage 的 key-value 的存储方式，但功能更强大，且存储空间更大。</p>
<p>Android 在4.4开始加入对 IndexedDB 的支持，只需打开允许 JS 执行的开关就好了</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">WebSettings webSettings = myWebView.getSettings();</div><div class="line">webSettings.setJavaScriptEnabled(<span class="keyword">true</span>);</div></pre></td></tr></table></figure>
<ul>
<li>File System API (android不支持）</li>
</ul>
<blockquote>
<p>File System API 是 H5 新加入的存储机制。它为 Web App 提供了一个虚拟的文件系统，就像 Native App 访问本地文件系统一样。由于安全性的考虑，这个虚拟文件系统有一定的限制。Web App 在虚拟的文件系统中，可以进行文件（夹）的创建、读、写、删除、遍历等操作。很可惜到目前，Android 系统的 WebView 还不支持 File System API。</p>
<p>简单的介绍完了上面六种 H5 常用的缓存模式，想必大家能对 Android WebView 所支持的缓存模式有个粗略的了解。如果想和前端更好的配合使用 Android WebView 所支持的缓存，建议看下这篇文章<a href="https://link.juejin.im/?target=http%3A%2F%2Fbugly.qq.com%2Fbbs%2Fforum.php%3Fmod%3Dviewthread%26tid%3D267" target="_blank" rel="external">《H5 缓存机制浅析 移动端 Web 加载性能优化》</a></p>
</blockquote>
<h3 id="清理缓存"><a href="#清理缓存" class="headerlink" title="清理缓存"></a>清理缓存</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">   * 清除WebView缓存</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearWebViewCache</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">      <span class="comment">//清理Webview缓存数据库</span></div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">          deleteDatabase(<span class="string">"WebView.db"</span>);</div><div class="line">          deleteDatabase(<span class="string">"WebViewCache.db"</span>);</div><div class="line"></div><div class="line">          mWebView.clearHistory();</div><div class="line">          mWebView.clearFormData();</div><div class="line">          getCacheDir().delete();</div><div class="line"></div><div class="line">	<span class="comment">//清空所有Cookie</span></div><div class="line">          CookieSyncManager.createInstance(<span class="keyword">this</span>);</div><div class="line">          CookieManager cookieManager = CookieManager.getInstance();</div><div class="line">          cookieManager.removeAllCookie();</div><div class="line">          CookieSyncManager.getInstance().sync();</div><div class="line"></div><div class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">          e.printStackTrace();</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">//WebView 缓存文件</span></div><div class="line">      File appCacheDir = <span class="keyword">new</span> File(getFilesDir().getAbsolutePath() + APP_CACAHE_DIRNAME);</div><div class="line"></div><div class="line">      File webviewCacheDir = <span class="keyword">new</span> File(getCacheDir().getAbsolutePath() + <span class="string">"/webviewCache"</span>);</div><div class="line"></div><div class="line">      <span class="comment">//删除webview 缓存目录</span></div><div class="line">      <span class="keyword">if</span> (webviewCacheDir.exists()) &#123;</div><div class="line">          deleteFile(webviewCacheDir);</div><div class="line">      &#125;</div><div class="line">      <span class="comment">//删除webview 缓存 缓存目录</span></div><div class="line">      <span class="keyword">if</span> (appCacheDir.exists()) &#123;</div><div class="line">          deleteFile(appCacheDir);</div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h2 id="OOM-内存泄漏）"><a href="#OOM-内存泄漏）" class="headerlink" title="OOM (内存泄漏）"></a>OOM (内存泄漏）</h2><p>Webview在加载页面的时候会占用非常大的内存，当页面当中存在大量图片，占用内存的情况会更严重。打开新页面后快速回退，内存也不会释放。这时候就会导致OOM的问题出现。</p>
<p>解决方法：</p>
<ol>
<li>通常根治这个问题的办法是为WebView开启另外一个进程，通过AIDL与主进程进行通信，WebView所在的进程可以根据业务的需要选择合适的时机进行销毁，从而达到内存的完整释放。因为webview引发的 资源无法释放等问题 全部可以解决。</li>
</ol>
<p>在xml中配置<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android:process=<span class="string">":remote"</span></div></pre></td></tr></table></figure></p>
<ol>
<li><p>使用Crosswalk-lite  或者 Cordova webview代替</p>
</li>
<li><p>用个反射，自己关掉</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConfigCallback</span><span class="params">(WindowManager windowManager)</span> </span>&#123;  </div><div class="line">    <span class="keyword">try</span> &#123;  </div><div class="line">        Field field = WebView.class.getDeclaredField(<span class="string">"mWebViewCore"</span>);  </div><div class="line">        field = field.getType().getDeclaredField(<span class="string">"mBrowserFrame"</span>);  </div><div class="line">        field = field.getType().getDeclaredField(<span class="string">"sConfigCallback"</span>);  </div><div class="line">        field.setAccessible(<span class="keyword">true</span>);  </div><div class="line">        Object configCallback = field.get(<span class="keyword">null</span>);  </div><div class="line">   </div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == configCallback) &#123;  </div><div class="line">            <span class="keyword">return</span>;  </div><div class="line">        &#125;  </div><div class="line">   </div><div class="line">        field = field.getType().getDeclaredField(<span class="string">"mWindowManager"</span>);  </div><div class="line">        field.setAccessible(<span class="keyword">true</span>);  </div><div class="line">        field.set(configCallback, windowManager);  </div><div class="line">    &#125; <span class="keyword">catch</span>(Exception e) &#123;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;  </div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);  </div><div class="line">    setConfigCallback((WindowManager)getApplicationContext().getSystemService(Context.WINDOW_SERVICE));  </div><div class="line">&#125;  </div><div class="line">   </div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;  </div><div class="line">    setConfigCallback(<span class="keyword">null</span>);  </div><div class="line">    <span class="keyword">super</span>.onDestroy();  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>缺点是，这个方法是依赖android.webkit implementation，android4.4之后就用chromium内核了，也就是4.4之后这个方法就不适用了。</p>
<ol>
<li>WebView 动态加载</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">WebView      mWebView = <span class="keyword">new</span> WebView(getApplicationgContext());  </div><div class="line">FrameLayout frameLayout      = findViewById(R.id.xwalk_view);  </div><div class="line">frameLayout.addView(mWebView);</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;  </div><div class="line">      <span class="keyword">super</span>.onDestroy();  </div><div class="line">      mWebView.removeAllViews();  </div><div class="line">       ((ViewGroup) mWebView.getParent()).removeView(mWebView);</div><div class="line">        mWebView.setTag(<span class="keyword">null</span>);</div><div class="line">        mWebView.clearHistory();</div><div class="line">        mWebView.destroy();</div><div class="line">        mWebView= <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>第四种方法，如果你需要在WebView中打开链接或者你打开的页面带有flash，获得你的WebView想弹出一个dialog，都会导致从ApplicationContext到ActivityContext的强制类型转换错误，从而导致你应用崩溃。这是因为在加载flash的时候，系统会首先把你的WebView作为父控件，然后在该控件上绘制flash，他想找一个Activity的Context来绘制他，但是你传入的是ApplicationContext。</p>
</blockquote>
<h2 id="视频播放"><a href="#视频播放" class="headerlink" title="视频播放"></a>视频播放</h2><p>（待续…）</p>
<h2 id="安全相关"><a href="#安全相关" class="headerlink" title="安全相关"></a>安全相关</h2><h3 id="源生JSInterface漏洞"><a href="#源生JSInterface漏洞" class="headerlink" title="源生JSInterface漏洞"></a>源生JSInterface漏洞</h3><h4 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h4><p><a href="http://blog.csdn.net/leehong2005/article/details/11808557" target="_blank" rel="external">Android WebView的Js对象注入漏洞解决方案 - CSDN博客</a><br>在android 4.2 之前，webview存在着漏洞 ,通过js ,可以访问设备SD卡上的任何东西，甚至联系人、短信等。</p>
<blockquote>
<p>当JS拿到Android这个对象后，就可以调用这个Android对象中所有的方法，包括系统类（java.lang.Runtime 类），从而进行任意代码执行</p>
<p>1，WebView添加了JavaScript对象，并且当前应用具有读写SDCard的权限，也就是：android.permission.WRITE_EXTERNAL_STORAGE<br>2，JS中可以遍历window对象，找到存在“getClass”方法的对象的对象，然后再通过反射的机制，得到Runtime对象，然后调用静态方法来执行一些命令，比如访问文件的命令.<br>3，再从执行命令后返回的输入流中得到字符串，就可以得到文件名的信息了。然后想干什么就干什么，好危险。核心JS代码如下</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params">cmdArgs</span>)  </span></div><div class="line"><span class="function"></span>&#123;  </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> obj <span class="keyword">in</span> <span class="built_in">window</span>) &#123;  </div><div class="line">        <span class="keyword">if</span> (<span class="string">"getClass"</span> <span class="keyword">in</span> <span class="built_in">window</span>[obj]) &#123;  </div><div class="line">            alert(obj);  </div><div class="line">            <span class="keyword">return</span>  <span class="built_in">window</span>[obj].getClass().forName(<span class="string">"java.lang.Runtime"</span>)  </div><div class="line">                 .getMethod(<span class="string">"getRuntime"</span>,<span class="literal">null</span>).invoke(<span class="literal">null</span>,<span class="literal">null</span>).exec(cmdArgs);  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><h5 id="JavascriptInterface-（android-4-2以上）"><a href="#JavascriptInterface-（android-4-2以上）" class="headerlink" title="@JavascriptInterface （android 4.2以上）"></a>@JavascriptInterface （android 4.2以上）</h5><p>Android 4.2 以上的系统能通过声明 @JavascriptInterface来解决<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">JsObject</span> </span>&#123;  </div><div class="line">   <span class="meta">@JavascriptInterface</span>  </div><div class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="string">"injectedObject"</span>; &#125;  </div><div class="line">&#125;  </div><div class="line">webView.addJavascriptInterface(<span class="keyword">new</span> JsObject(), <span class="string">"injectedObject"</span>);  </div><div class="line">webView.loadData(<span class="string">""</span>, <span class="string">"text/html"</span>, <span class="keyword">null</span>);  </div><div class="line">webView.loadUrl(<span class="string">"javascript:alert(injectedObject.toString())"</span>);</div></pre></td></tr></table></figure></p>
<h5 id="WebChromeClient-的-prompt-进行拦截"><a href="#WebChromeClient-的-prompt-进行拦截" class="headerlink" title="WebChromeClient  的 prompt() 进行拦截"></a>WebChromeClient  的 prompt() 进行拦截</h5><p><a href="http://upload-images.jianshu.io/upload_images/944365-1385f748618af886.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="external">常用对话框方法</a></p>
<blockquote>
<p>Android通过 WebChromeClient 的onJsAlert()、onJsConfirm()、onJsPrompt（）方法回调分别拦截JS对话框<br>（即上述三个方法），得到他们的消息内容，然后解析即可</p>
<p>因为只有prompt（）可以返回任意类型的值，操作最全面方便、更加灵活</p>
</blockquote>
<p>Js代码：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">clickprompt</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">// 调用prompt（）</span></div><div class="line">    <span class="keyword">var</span> result=prompt(<span class="string">"js://demo?arg1=111&amp;arg2=222"</span>);</div><div class="line">    alert(<span class="string">"demo "</span> + result);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在WebChromeClient 中重写 onJsPrompt()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 设置与Js交互的权限</span></div><div class="line">webSettings.setJavaScriptEnabled(<span class="keyword">true</span>);</div><div class="line"><span class="comment">// 设置允许JS弹窗   webSettings.setJavaScriptCanOpenWindowsAutomatically(true);</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onJsPrompt</span><span class="params">(WebView view, String url, String message, String defaultValue, JsPromptResult result)</span> </span>&#123;</div><div class="line"><span class="comment">// 根据协议的参数，判断是否是所需要的url(原理同方式2)</span></div><div class="line"><span class="comment">// 一般根据scheme（协议格式） &amp; authority（协议名）判断（前两个参数）</span></div><div class="line"><span class="comment">//假定传入进来的 url = "js://webview?arg1=111&amp;arg2=222"（同时也是约定好的需要拦截的）</span></div><div class="line"></div><div class="line">Uri uri = Uri.parse(message);</div><div class="line"><span class="comment">// 如果url的协议 = 预先约定的 js 协议</span></div><div class="line"><span class="comment">// 就解析往下解析参数</span></div><div class="line"><span class="keyword">if</span> ( uri.getScheme().equals(<span class="string">"js"</span>)) &#123;</div><div class="line"></div><div class="line"><span class="comment">// 如果 authority  = 预先约定协议里的 webview，即代表都符合约定的协议</span></div><div class="line"><span class="comment">// 所以拦截url,下面JS开始调用Android需要的方法</span></div><div class="line"> <span class="keyword">if</span> (uri.getAuthority().equals(<span class="string">"webview"</span>)) &#123;</div><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// 执行JS所需要调用的逻辑</span></div><div class="line">                                                    System.out.println(<span class="string">"js调用了Android的方法"</span>);</div><div class="line"><span class="comment">// 可以在协议上带有参数并传递到Android上</span></div><div class="line">                                                    HashMap&lt;String, String&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">                                                    Set&lt;String&gt; collection = uri.getQueryParameterNames();</div><div class="line"></div><div class="line"><span class="comment">//参数result:代表消息框的返回值(输入值)</span></div><div class="line">                                                    result.confirm(<span class="string">"js调用了Android的方法成功啦"</span>);</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> <span class="keyword">super</span>.onJsPrompt(view, url, message, defaultValue, result);</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>在Android的onJsPrompt（）中 ，解析传递过来的信息，再通过反射机制调用Java对象的方法，这样实现安全的JS调用Android代码</p>
<p>prompt中是我们约定的字符串，它包含特定的标识符MyApp:，后面包含了一串JSON字符串，它包含了方法名，参数，对象名等。</p>
</blockquote>
<p>问题：</p>
<blockquote>
<p>由于通过反射的形式来得到指定对象的方法，他会把基类的方法也会得到，最顶层的基类就是Object，所以我们为了不把getClass方法注入到Js中，所以我们需要把Object的公有方法过滤掉</p>
</blockquote>
<h5 id="JSBridge"><a href="#JSBridge" class="headerlink" title="JSBridge"></a>JSBridge</h5><p>JSBridge也是使用prompt()方法拦截，只不过它定义了自己的通信协议。<br>完整的协议定义：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jsbridge:<span class="comment">//className:callbackAddress/methodName?jsonObj</span></div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1760285-32d3e813305b8b4e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="jsbridge原理图"></p>
<blockquote>
<p>当js调用native功能时，应当指定native层要完成某个功能调用的类名（className）和方法名（methodName），以及js传递过来的参数（jsonObj）。port值是指当native需要将操作结果返回给js时，在js中定义一个callback，并将这个callback存储在指定的位置上，这个port就定义了callback的存储位置。</p>
<p>JSBridge类管理暴露给前端方法，前端调用的方法应该在此类中注册才可使用。register的实现是从Map中查找key是否存在，不存在则反射取得对应class中的所有方法,具体方法是在BridgeImpl中定义的，方法包括三个参数分别为WebView、JSONObject、CallBack。如果满足条件，则将所有满足条件的方法put到map中。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, HashMap&lt;String, Method&gt;&gt; exposedMethods = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(String exposedName, Class&lt;? extends IBridge&gt; clazz)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!exposedMethods.containsKey(exposedName)) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                exposedMethods.put(exposedName, getAllMethod(clazz));</div><div class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>JSBridge的基本原理为：<br>H5-&gt;通过某种方式触发一个url-&gt;Native捕获到url,进行分析-&gt;原生做处理-&gt;Native调用H5的JSBridge对象传递回调。如下图</p>
</blockquote>
<p><a href="http://upload-images.jianshu.io/upload_images/2327406-a45afb11e62699dc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="external">h5与原生页面通过jsbridge交互</a></p>
<h2 id="第三方内核"><a href="#第三方内核" class="headerlink" title="第三方内核"></a>第三方内核</h2><h3 id="TbsX5-（腾讯浏览器服务）"><a href="#TbsX5-（腾讯浏览器服务）" class="headerlink" title="TbsX5 （腾讯浏览器服务）"></a>TbsX5 （腾讯浏览器服务）</h3><blockquote>
<p>TbsX5基于谷歌Blink内核，并提供两种集成方案：<br><em>1)只共享微信手Q空间的x5内核(for share)</em><br><em>2)独立下载x5内核(with download)</em></p>
</blockquote>
<p>当用户已经安装了微信或者手Q ，webview默认会使用 x5内核。反之，则使用系统默认的内核版本。</p>
<p><a href="https://x5.tencent.com/tbs/guide/sdkInit.html" target="_blank" rel="external">x5接入</a></p>
<blockquote>
<p>辨别是否使用x5webview的方法：<br>显示网页文字时，可通过长按选择文字的标识判断，如下水滴状选择效果是x5webview 的标志：</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1760285-876ad266e613ccd1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="x5成功接入"></p>
<h3 id="Crosswalk"><a href="#Crosswalk" class="headerlink" title="Crosswalk"></a>Crosswalk</h3><blockquote>
<p>Crosswalk是一款开源的Web引擎，其基于 Chromium/Blink 的应用运行环境</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1760285-f2cf1fbe3ffc2a7b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Crosswalk 跟 lite 版本大小对比"></p>
<p>从官网的说明可以知道，使用Crosswalk后，apk的大小会增加20M 。 而使用Crosswalk Lite版本（移除较不常见的库和特性），apk的大小会增加10-15M。</p>
<ul>
<li>Lite目前只支持Android，并且不支持共享模式</li>
<li>Lite只支持x86和ARM的32位版本。x86_64和ARM64都还未支持</li>
</ul>
<p>因此，Crosswalk 会增大apk的大小 ，而lite 版本则兼容性存在问题。不是很推荐使用。</p>
<h3 id="Cordova"><a href="#Cordova" class="headerlink" title="Cordova"></a>Cordova</h3><blockquote>
<p>Cordova是贡献给Apache后的开源项目，是从PhoneGap中抽出的核心代码，是驱动PhoneGap的核心引擎。Adobe将会继续以Cordova加上PhoneGap Build和Adobe Shadow的组合提供PhoneGap。 </p>
</blockquote>
<ul>
<li>移动应用程序使用Html、Css、JS </li>
<li>Cordova提供了一组设备相关的API，通过这组API，移动应用能够以JavaScript访问原生的设备功能，如摄像头、麦克风等。 </li>
<li>一次开发多个平台 </li>
<li>开源免费</li>
</ul>
<p><a href="https://crosswalk-project.org/documentation/cordova_zh.html" target="_blank" rel="external">Cordova应用开发</a><br><a href="http://www.jianshu.com/p/0a6b05abca0f" target="_blank" rel="external">Android使用Cordova进行混合开发</a></p>
<p>可以在Cordova上面集成 Crosswalk webview插件</p>
<blockquote>
<p>随着Cordova Android 4.0.0引入了对插入式webview的支持，现在你可以方便地在你的Cordova应用上使用Crosswalk的webview。通过使用Crosswalk的webview插件，开发者可以享用远程调试的功能，前沿的HTML5特性，例如WebGL, WebAudio和WebRTC，以及在包括Android 4.0 Ice Cream Sandwich(ICS)在内的Android设备上性能的显著提升。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cordova plugin add cordova-plugin-crosswalk-webview</div></pre></td></tr></table></figure>
<blockquote>
<p>缺点<br>Increased memory footprint<br>An overhead of ~30MB (as reported by the RSS column of ps)<br><em>Increased APK size (about 17MB) 增加apk大小大约17M</em><br>Increased size on disk when installed (about 50MB)<br>Crosswalk WebView stores data (IndexedDB, LocalStorage, etc) separately from System WebView<br>You’ll need to manually migrate local data when switching between the two (note: this is fixed in Crosswalk 15)</p>
</blockquote>
<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><h3 id="资源预加载"><a href="#资源预加载" class="headerlink" title="资源预加载"></a>资源预加载</h3><p>在页面加载的工程中，许多外部依赖的JS、CSS、图片等资源需要下载，我们能提前将这些资源下载好，等H5 加载时直接替换</p>
<blockquote>
<p>好在从 API 11（Android 3.0）开始，WebView 引入了 <code>shouldInterceptRequest</code>函数，这个函数有两种重载。</p>
<ol>
<li><p><code>public WebResourceResponse shouldInterceptRequest(WebView webView, String url)</code>从 API 11 引入，API 21 废弃</p>
<ol>
<li><code>public WebResourceResponse shouldInterceptRequest (WebView view, WebResourceRequest request)</code>从 API 21 开始引入</li>
</ol>
</li>
</ol>
<p>考虑到目前大多数 App 还要支持 API 14，所以还是使用 <code>shouldInterceptRequest (WebView view, String url)</code>为例。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">mWebView.setWebViewClient(<span class="keyword">new</span> WebViewClient() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> WebResourceResponse <span class="title">shouldInterceptRequest</span><span class="params">(WebView webView, <span class="keyword">final</span> String url)</span> </span>&#123;</div><div class="line">                WebResourceResponse response = <span class="keyword">null</span>;</div><div class="line">                <span class="keyword">boolean</span> resDown = JSHelper.isURLDownValid(url);</div><div class="line">                <span class="keyword">if</span> (resDown) &#123;</div><div class="line">                    jsStr = JsjjJSHelper.getResInputStream(url);</div><div class="line">                    <span class="keyword">if</span> (url.endsWith(<span class="string">".png"</span>)) &#123;</div><div class="line">                        response = getWebResourceResponse(url, <span class="string">"image/png"</span>, <span class="string">".png"</span>);</div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url.endsWith(<span class="string">".gif"</span>)) &#123;</div><div class="line">                        response = getWebResourceResponse(url, <span class="string">"image/gif"</span>, <span class="string">".gif"</span>);</div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url.endsWith(<span class="string">".jpg"</span>)) &#123;</div><div class="line">                        response = getWebResourceResponse(url, <span class="string">"image/jepg"</span>, <span class="string">".jpg"</span>);</div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url.endsWith(<span class="string">".jepg"</span>)) &#123;</div><div class="line">                        response = getWebResourceResponse(url, <span class="string">"image/jepg"</span>, <span class="string">".jepg"</span>);</div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url.endsWith(<span class="string">".js"</span>) &amp;&amp; jsStr != <span class="keyword">null</span>) &#123;</div><div class="line">                        response = getWebResourceResponse(<span class="string">"text/javascript"</span>, <span class="string">"UTF-8"</span>, <span class="string">".js"</span>);</div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url.endsWith(<span class="string">".css"</span>) &amp;&amp; jsStr != <span class="keyword">null</span>) &#123;</div><div class="line">                        response = getWebResourceResponse(<span class="string">"text/css"</span>, <span class="string">"UTF-8"</span>, <span class="string">".css"</span>);</div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url.endsWith(<span class="string">".html"</span>) &amp;&amp; jsStr != <span class="keyword">null</span>) &#123;</div><div class="line">                        response = getWebResourceResponse(<span class="string">"text/html"</span>, <span class="string">"UTF-8"</span>, <span class="string">".html"</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> response;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="function"><span class="keyword">private</span> WebResourceResponse <span class="title">getWebResourceResponse</span><span class="params">(String url, String mime, String style)</span> </span>&#123;</div><div class="line">        WebResourceResponse response = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            response = <span class="keyword">new</span> WebResourceResponse(mime, <span class="string">"UTF-8"</span>, <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(getJSPath() + TPMD5.md5String(url) + style)));</div><div class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> response;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getJsjjJSPath</span><span class="params">()</span> </span>&#123;</div><div class="line">        String splashTargetPath = JarEnv.sApplicationContext.getFilesDir().getPath() + <span class="string">"/JS"</span>;</div><div class="line">        <span class="keyword">if</span> (!TPFileSysUtil.isDirFileExist(splashTargetPath)) &#123;</div><div class="line">            TPFileSysUtil.createDir(splashTargetPath);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> splashTargetPath + <span class="string">"/"</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="JS本地化延迟加载"><a href="#JS本地化延迟加载" class="headerlink" title="JS本地化延迟加载"></a>JS本地化延迟加载</h3><p>（待续）</p>
<h2 id="webview调试"><a href="#webview调试" class="headerlink" title="webview调试"></a>webview调试</h2><p>从Android 4.4 (KitKat)开始，使用Chrome开发者工具可以远程调试Webview网页内容</p>
<ol>
<li>将webview 设置成调试模式 </li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</div><div class="line">    WebView.setWebContentsDebuggingEnabled(<span class="keyword">true</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>使用USB连接PC 与 设备 ，保证adb 一直运行着</li>
<li><p>在chrome中输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chrome://inspect</div></pre></td></tr></table></figure>
</li>
<li><p>点击inspect , 进入调试界面</p>
</li>
</ol>
<p><img src="http://upload-images.jianshu.io/upload_images/1760285-3c824ed614fb5a54.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="调试界面"></p>
<blockquote>
<p>参考：<br><a href="http://www.jianshu.com/p/7f4b557e77c9" target="_blank" rel="external">Android WebView的基本使用与注意点 - 简书</a><br> <a href="http://www.jianshu.com/p/8826b65dd880" target="_blank" rel="external">关于Android WebView的那些事 - 简书</a><br><a href="http://blog.csdn.net/leehong2005/article/details/11808557" target="_blank" rel="external">Android WebView的Js对象注入漏洞解决方案 - CSDN博客</a><br><a href="http://blog.csdn.net/lowprofile_coding/article/details/77928614" target="_blank" rel="external">Android WebView基本使用 - CSDN博客</a><br><a href="http://www.jianshu.com/p/2857d55e2f6e" target="_blank" rel="external">WebChromeClient常用API与功能使用详解 - 简书</a><br><a href="https://juejin.im/entry/57d6434067f3560057e50b20" target="_blank" rel="external">Android WebView：性能优化不得不说的事 - Android - 掘金</a><br><a href="http://blog.csdn.net/sbsujjbcy/article/details/50752595" target="_blank" rel="external">Android JSBridge的原理与实现 - CSDN博客</a><br><a href="http://www.jianshu.com/p/2ec3f06d6087" target="_blank" rel="external">Android中JSBridge的原理与实现 - 简书</a></p>
</blockquote>

      
    </div>
    
    
    
    <div>
      
        
<div style="text-align:center;color: #ccc;font-size:14px;">
------ 本文结束 感谢阅读------</div>
<br/>
<div>   
  <ul class="post-copyright" style="border-left:3px solid #ff1700;list-style:none;margin:2em 0 0;padding:0.5em 1em;background-color:#f9f9f9">
    <li class="post-copyright-author">
      <strong>本文作者：</strong>
      小面包屑
    </li>
    <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://lethisis.com/archives/7a9897da.html" title="关于 android Webview">http://lethisis.com/archives/7a9897da.html</a>
    </li>
    <li class="post-copyright-license">
      <strong>声明： </strong>
      原创文章，有问题请评论中留言。支持友情链接。非商业转载请注明作者及出处。商业转载请联系作者本人。
    </li>
  </ul>
</div>

      
    </div>


    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/images/qrcode_for_gh_857b9a059fb9_258.jpg" alt="小面包屑 wechat" style="width: 200px; max-width: 100%;"/>
    <div>欢迎您扫一扫上面的微信公众号，订阅我的公众号！</div>
</div>

      </div>
    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag"># Android</a>
          
            <a href="/tags/view/" rel="tag"># view</a>
          
            <a href="/tags/Webview/" rel="tag"># Webview</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/archives/12191df9.html" rel="next" title="Kotlin 学习笔记">
                <i class="fa fa-chevron-left"></i> Kotlin 学习笔记
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="SOHUCS"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar_luwan.jpeg"
                alt="小面包屑" />
            
              <p class="site-author-name" itemprop="name">小面包屑</p>
              <p class="site-description motion-element" itemprop="description">就喜欢这样记录一下</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">23</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/extramoney" target="_blank" title="GitHub" rel="external nofollow">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="http://www.jianshu.com/u/7828c04ec9ca" target="_blank" title="简书" rel="external nofollow">
                    
                      <i class="fa fa-fw fa-link"></i>简书</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#基本使用"><span class="nav-number">1.</span> <span class="nav-text">基本使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#加载html四种方式"><span class="nav-number">1.1.</span> <span class="nav-text">加载html四种方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#简单使用"><span class="nav-number">1.2.</span> <span class="nav-text">简单使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#在AndroidManifest-xml中添加网络权限"><span class="nav-number">1.2.1.</span> <span class="nav-text">在AndroidManifest.xml中添加网络权限</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#布局文件-activity-main-xml"><span class="nav-number">1.2.2.</span> <span class="nav-text">布局文件 activity_main.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MainActivity-java-webview-动态加载"><span class="nav-number">1.2.3.</span> <span class="nav-text">MainActivity.java webview 动态加载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WebViewClient与WebChromeClient区别"><span class="nav-number">1.2.4.</span> <span class="nav-text">WebViewClient与WebChromeClient区别</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#WebChromeClient高级功能实现"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">WebChromeClient高级功能实现</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#让你的webview支持File-Input-标签"><span class="nav-number">1.2.4.1.1.</span> <span class="nav-text">让你的webview支持File Input 标签</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#设置webview视频未播放时默认显示占位"><span class="nav-number">1.2.4.1.2.</span> <span class="nav-text">设置webview视频未播放时默认显示占位</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WebView下载监听"><span class="nav-number">1.2.5.</span> <span class="nav-text">WebView下载监听</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#webView-设置"><span class="nav-number">1.2.6.</span> <span class="nav-text">webView 设置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#返回webView的上一页面"><span class="nav-number">1.2.7.</span> <span class="nav-text">返回webView的上一页面</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#内核版本"><span class="nav-number">2.</span> <span class="nav-text">内核版本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Webkit内核"><span class="nav-number">2.1.</span> <span class="nav-text">Webkit内核</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chrominum内核"><span class="nav-number">2.2.</span> <span class="nav-text">Chrominum内核</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Blink内核"><span class="nav-number">2.3.</span> <span class="nav-text">Blink内核</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缓存"><span class="nav-number">3.</span> <span class="nav-text">缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#常用缓存机制"><span class="nav-number">3.1.</span> <span class="nav-text">常用缓存机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#清理缓存"><span class="nav-number">3.2.</span> <span class="nav-text">清理缓存</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OOM-内存泄漏）"><span class="nav-number">4.</span> <span class="nav-text">OOM (内存泄漏）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#视频播放"><span class="nav-number">5.</span> <span class="nav-text">视频播放</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安全相关"><span class="nav-number">6.</span> <span class="nav-text">安全相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#源生JSInterface漏洞"><span class="nav-number">6.1.</span> <span class="nav-text">源生JSInterface漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#漏洞描述"><span class="nav-number">6.1.1.</span> <span class="nav-text">漏洞描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#解决方案"><span class="nav-number">6.1.2.</span> <span class="nav-text">解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#JavascriptInterface-（android-4-2以上）"><span class="nav-number">6.1.2.1.</span> <span class="nav-text">@JavascriptInterface （android 4.2以上）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#WebChromeClient-的-prompt-进行拦截"><span class="nav-number">6.1.2.2.</span> <span class="nav-text">WebChromeClient  的 prompt() 进行拦截</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#JSBridge"><span class="nav-number">6.1.2.3.</span> <span class="nav-text">JSBridge</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第三方内核"><span class="nav-number">7.</span> <span class="nav-text">第三方内核</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TbsX5-（腾讯浏览器服务）"><span class="nav-number">7.1.</span> <span class="nav-text">TbsX5 （腾讯浏览器服务）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Crosswalk"><span class="nav-number">7.2.</span> <span class="nav-text">Crosswalk</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cordova"><span class="nav-number">7.3.</span> <span class="nav-text">Cordova</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优化"><span class="nav-number">8.</span> <span class="nav-text">优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#资源预加载"><span class="nav-number">8.1.</span> <span class="nav-text">资源预加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JS本地化延迟加载"><span class="nav-number">8.2.</span> <span class="nav-text">JS本地化延迟加载</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#webview调试"><span class="nav-number">9.</span> <span class="nav-text">webview调试</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小面包屑</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io" rel="external nofollow">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">NexT.Mist</a> v5.1.3

<span class="post-meta-divider">|</span>
</div>


<div class="theme-info">
Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a>
</div>







<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("cMR2jxHtdxqiJIqjoizePELm-gzGzoHsz", "nXoySFNtF4zR5aibCOQgTgGW");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
